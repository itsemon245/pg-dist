coordinator:
  image: citusdata/citus:13.0.3
  container_name: ${COORD_CONTAINER}
  command: postgres -c config_file=/etc/postgresql/postgresql.conf
  ports:
    - "${COORD_PORT}:5432"
  environment:
    POSTGRES_USER: ${POSTGRES_USER}
    POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
    POSTGRES_DB: ${POSTGRES_DB}
    # Useful for psql connections initiated from inside the container
    PGUSER: ${POSTGRES_USER}
    PGPASSWORD: ${POSTGRES_PASSWORD}
  volumes:
    - ./initdb/coordinator:/docker-entrypoint-initdb.d
    - ./config/coordinator.conf:/etc/postgresql/postgresql.conf
  healthcheck:
    test:
      ["CMD", "pg_isready", "-U", "${POSTGRES_USER}", "-d", "${POSTGRES_DB}"]
    interval: 5s
    timeout: 3s
    retries: 30
  restart: unless-stopped
  networks:
    - citus
